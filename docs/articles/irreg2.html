<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interpolating irregular data • guerrilla</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">guerrilla</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/irreg2.html">Interpolating irregular data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mdsumner/guerrilla">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Interpolating irregular data</h1>
                        <h4 class="author">Michael D. Sumner</h4>
            
            <h4 class="date">2017-12-14</h4>
          </div>

    
    
<div class="contents">
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>Define utility functions for repeated usage, and load required packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scl &lt;-<span class="st"> </span><span class="cf">function</span>(x) (x <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))<span class="op">/</span><span class="kw">diff</span>(<span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))
<span class="kw">library</span>(guerrilla)
<span class="kw">library</span>(raster)
<span class="co">#&gt; Loading required package: sp</span>
<span class="kw">library</span>(rgdal)
<span class="co">#&gt; rgdal: version: 1.2-16, (SVN revision 701)</span>
<span class="co">#&gt;  Geospatial Data Abstraction Library extensions to R successfully loaded</span>
<span class="co">#&gt;  Loaded GDAL runtime: GDAL 2.2.2, released 2017/09/15</span>
<span class="co">#&gt;  Path to GDAL shared files: /usr/share/gdal/2.2</span>
<span class="co">#&gt;  GDAL binary built with GEOS: TRUE </span>
<span class="co">#&gt;  Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]</span>
<span class="co">#&gt;  Path to PROJ.4 shared files: (autodetected)</span>
<span class="co">#&gt;  Linking to sp version: 1.2-5</span>
<span class="kw">library</span>(gstat)
<span class="kw">library</span>(fields)
<span class="co">#&gt; Loading required package: spam</span>
<span class="co">#&gt; Loading required package: dotCall64</span>
<span class="co">#&gt; Loading required package: grid</span>
<span class="co">#&gt; Spam version 2.1-1 (2017-07-02) is loaded.</span>
<span class="co">#&gt; Type 'help( Spam)' or 'demo( spam)' for a short introduction </span>
<span class="co">#&gt; and overview of this package.</span>
<span class="co">#&gt; Help for individual functions is also obtained by adding the</span>
<span class="co">#&gt; suffix '.spam' to the function name, e.g. 'help( chol.spam)'.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'spam'</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     backsolve, forwardsolve</span>
<span class="co">#&gt; Loading required package: maps</span>
<span class="kw">library</span>(akima)
<span class="kw">library</span>(palr)</code></pre></div>
<p>Read the zooplankton data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readxl)
bw &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(<span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"BW-Zooplankton_env.xls"</span>, <span class="dt">package=</span> <span class="st">"irreg"</span>))
<span class="kw">summary</span>(bw[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>])
<span class="co">#&gt;     Station            Lat              Lon            depth     </span>
<span class="co">#&gt;  Min.   :  4.00   Min.   :-69.11   Min.   :29.98   Min.   : 175  </span>
<span class="co">#&gt;  1st Qu.: 37.25   1st Qu.:-66.84   1st Qu.:40.00   1st Qu.:1523  </span>
<span class="co">#&gt;  Median : 60.00   Median :-65.84   Median :55.06   Median :3065  </span>
<span class="co">#&gt;  Mean   : 64.36   Mean   :-65.46   Mean   :54.60   Mean   :2791  </span>
<span class="co">#&gt;  3rd Qu.:100.25   3rd Qu.:-64.09   3rd Qu.:70.00   3rd Qu.:4114  </span>
<span class="co">#&gt;  Max.   :122.00   Max.   :-61.66   Max.   :80.02   Max.   :5075  </span>
<span class="co">#&gt;       temp              sal         chl a mg/m2)       ASC (km)      </span>
<span class="co">#&gt;  Min.   :-1.6712   Min.   :33.93   Min.   : 29.60   Min.   :-39.600  </span>
<span class="co">#&gt;  1st Qu.:-1.4726   1st Qu.:34.14   1st Qu.: 44.91   1st Qu.:  4.125  </span>
<span class="co">#&gt;  Median :-1.1332   Median :34.25   Median : 53.00   Median :114.950  </span>
<span class="co">#&gt;  Mean   :-0.6755   Mean   :34.22   Mean   : 76.80   Mean   :187.506  </span>
<span class="co">#&gt;  3rd Qu.: 0.1435   3rd Qu.:34.31   3rd Qu.: 85.57   3rd Qu.:330.550  </span>
<span class="co">#&gt;  Max.   : 0.8815   Max.   :34.42   Max.   :352.51   Max.   :775.500  </span>
<span class="co">#&gt;  ice free days     Total abundance   </span>
<span class="co">#&gt;  Min.   :-35.322   Min.   :   459.3  </span>
<span class="co">#&gt;  1st Qu.:  6.108   1st Qu.:  4425.9  </span>
<span class="co">#&gt;  Median : 33.153   Median : 11346.1  </span>
<span class="co">#&gt;  Mean   : 33.139   Mean   : 23609.3  </span>
<span class="co">#&gt;  3rd Qu.: 62.901   3rd Qu.: 27417.3  </span>
<span class="co">#&gt;  Max.   :101.420   Max.   :116715.8</span>
lonlat &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/as.matrix">as.matrix</a></span>(bw[, <span class="kw">c</span>(<span class="st">"Lon"</span>, <span class="st">"Lat"</span>)])
val &lt;-<span class="st"> </span>bw<span class="op">$</span>temp
minmax &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">1.8</span>, <span class="dv">40</span>)

rval &lt;-<span class="st"> </span><span class="kw">pretty</span>(val, <span class="dt">n =</span> <span class="dv">15</span>)

cols &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/palr/topics/sstPal">sstPal</a></span>(<span class="kw">length</span>(rval) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<p>Plot the temperature data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(val)</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>Create a grid to interpolate onto, this can be used repeatedly for many methods.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster)

r0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(lonlat)</code></pre></div>
</div>
<div id="simplistic-rasterization" class="section level1">
<h1 class="hasAnchor">
<a href="#simplistic-rasterization" class="anchor"></a>Simplistic rasterization</h1>
<p>The most simple thing possible is to define a grid and simply populate that with values from points. Extend the grid by a small amount.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rasgrid &lt;-<span class="st"> </span><span class="cf">function</span>(xy, value, <span class="dt">grid =</span> <span class="ot">NULL</span>, ...) {
  <span class="cf">if</span> (<span class="kw">is.null</span>(grid)) grid &lt;-<span class="st"> </span><span class="kw"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(xy)
   <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/rasterize">rasterize</a></span>(xy, grid, <span class="dt">field =</span> value, ...)
}
lastgrid &lt;-<span class="st"> </span><span class="kw">rasgrid</span>(lonlat, val, r0)

<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(lastgrid)</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>the main impact on the result here is the effect of pixel size, and the behaviour when there is more than one value per pixel. It really depends on the data <strong>compare brokewest with saz?</strong></p>
</div>
<div id="thin-plate-spline-interpolation-" class="section level1">
<h1 class="hasAnchor">
<a href="#thin-plate-spline-interpolation-" class="anchor"></a>Thin plate spline interpolation.</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fields)
tpsfun &lt;-<span class="st"> </span><span class="cf">function</span>(xy, value, <span class="dt">grid =</span> <span class="ot">NULL</span>, ...) {
  <span class="cf">if</span> (<span class="kw">is.null</span>(grid)) grid &lt;-<span class="st"> </span><span class="kw"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(xy)
  model &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/fields/topics/Tps">Tps</a></span>(xy, value, <span class="dt">lon.lat =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/isLonLat">isLonLat</a></span>(grid), <span class="dt">method =</span> <span class="st">"REML"</span>)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/interpolate">interpolate</a></span>(grid, model, ...)
}
tpsgrid  &lt;-<span class="st"> </span><span class="kw">tpsfun</span>(lonlat, val)
tpsgrid &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/clamp">clamp</a></span>(tpsgrid, minmax[<span class="dv">1</span>], minmax[<span class="dv">2</span>])

## this shows the error
tpsSEgrid &lt;-<span class="st"> </span><span class="kw">tpsfun</span>(lonlat, val, r0, <span class="dt">fun =</span> predictSE)

<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(tpsgrid)</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
<div id="bilinear-triangulation-" class="section level1">
<h1 class="hasAnchor">
<a href="#bilinear-triangulation-" class="anchor"></a>Bilinear triangulation.</h1>
<p>This is identical to Matlab’s griddata(, method = “bilinear”)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(geometry)
<span class="co">#&gt; Loading required package: magic</span>
<span class="co">#&gt; Loading required package: abind</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'magic'</span>
<span class="co">#&gt; The following object is masked from 'package:raster':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     shift</span>
<span class="kw">library</span>(sp)
<span class="kw">library</span>(guerrilla)


trigrid &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tri_fun.html">tri_fun</a></span>(lonlat, val, r0)
<span class="co">#&gt; </span>
<span class="co">#&gt;      PLEASE </span><span class="al">NOTE</span><span class="co">:  As of version 0.3-5, no degenerate (zero area) </span>
<span class="co">#&gt;      regions are returned with the "Qt" option since the R </span>
<span class="co">#&gt;      code removes them from the triangulation. </span>
<span class="co">#&gt;      See help("delaunayn").</span>

<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(trigrid)</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div id="delaunay-and-diriclet" class="section level1">
<h1 class="hasAnchor">
<a href="#delaunay-and-diriclet" class="anchor"></a>Delaunay and Diriclet</h1>
<p>What about Delaunay and Dirichlet without interpolation?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## input must be ppp
<span class="kw">library</span>(spatstat)
<span class="co">#&gt; Loading required package: spatstat.data</span>
<span class="co">#&gt; Loading required package: nlme</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'nlme'</span>
<span class="co">#&gt; The following object is masked from 'package:raster':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     getData</span>
<span class="co">#&gt; Loading required package: rpart</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; spatstat 1.54-0       (nickname: 'Vacuous Mission Statement') </span>
<span class="co">#&gt; For an introduction to spatstat, type 'beginner'</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'spatstat'</span>
<span class="co">#&gt; The following object is masked from 'package:magic':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     shift</span>
<span class="co">#&gt; The following object is masked from 'package:palr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     col2hex</span>
<span class="co">#&gt; The following object is masked from 'package:gstat':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     idw</span>
<span class="co">#&gt; The following objects are masked from 'package:raster':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     area, rotate, shift</span>
<span class="kw">library</span>(maptools)
<span class="co">#&gt; Checking rgeos availability: TRUE</span>
rasterToOwin &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw"><a href="http://www.rdocumentation.org/packages/spatstat/topics/owin">owin</a></span>(<span class="kw">c</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/coordinates">xmin</a></span>(x), <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/coordinates">xmax</a></span>(x)), <span class="kw">c</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/coordinates">ymin</a></span>(x), <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/coordinates">ymax</a></span>(x)))
}
colfun &lt;-<span class="st"> </span>viridis<span class="op">::</span>viridis
rbase &lt;-<span class="st"> </span>r0
d &lt;-<span class="st"> </span>bw
xname &lt;-<span class="st"> "Lon"</span>
yname &lt;-<span class="st"> "Lat"</span>
varname &lt;-<span class="st"> "temp"</span>
pObj &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/spatstat/topics/ppp">ppp</a></span>(d[[xname]], d[[yname]], <span class="dt">window =</span> <span class="kw">rasterToOwin</span>(rbase), <span class="dt">marks =</span> d[[varname]])

lltes&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/spatstat/topics/delaunay">delaunay</a></span>(pObj)
<span class="co">#&gt; </span>
<span class="co">#&gt;      PLEASE </span><span class="al">NOTE</span><span class="co">:  The components "delsgs" and "summary" of the</span>
<span class="co">#&gt;  object returned by deldir() are now DATA FRAMES rather than</span>
<span class="co">#&gt;  matrices (as they were prior to release 0.0-18).</span>
<span class="co">#&gt;  See help("deldir").</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;      PLEASE </span><span class="al">NOTE</span><span class="co">: The process that deldir() uses for determining</span>
<span class="co">#&gt;  duplicated points has changed from that used in version</span>
<span class="co">#&gt;  0.0-9 of this package (and previously). See help("deldir").</span>
meanval &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(lltes[[<span class="dv">3</span>]]))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(meanval)) {
  meanval[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/spatstat/topics/marks">marks</a></span>(pObj[lltes[[<span class="dv">3</span>]][[i]]]))
       }
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw">as</span>(lltes, <span class="st">"SpatialPolygons"</span>), <span class="dt">col =</span> <span class="kw">colfun</span>(<span class="dv">20</span>)[<span class="kw">scl</span>(meanval)<span class="op">*</span><span class="dv">19</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>])
<span class="kw">points</span>(d[,<span class="kw">c</span>(xname, yname)])</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
lltes&lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/spatstat/topics/dirichlet">dirichlet</a></span>(pObj)
meanval &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(lltes[[<span class="dv">3</span>]]))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(meanval)) {
  meanval[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/spatstat/topics/marks">marks</a></span>(pObj[lltes[[<span class="dv">3</span>]][[i]]]))
  }

<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw">as</span>(lltes, <span class="st">"SpatialPolygons"</span>), <span class="dt">col =</span> <span class="kw">colfun</span>(<span class="dv">20</span>)[<span class="kw">scl</span>(meanval)<span class="op">*</span><span class="dv">19</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>])
<span class="kw">points</span>(d[,<span class="kw">c</span>(xname, yname)])</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-8-2.png" width="672"></p>
<p>Grid interpolation from Dirichlet or Delaunay. This is much slower than the triangulate and cart2bary method above (<strong>Mike needs to illustrate this</strong>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> 
 fcs.dir &lt;-<span class="st"> </span><span class="kw"><a href="../reference/facets.html">facets</a></span>(pObj, <span class="dt">nx =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">ncol</a></span>(rbase) , <span class="dt">ny =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(rbase), <span class="dt">method =</span> <span class="st">"dirichlet"</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  number of triangles = 50 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,</span>
<span class="co">#&gt; 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,  50.</span>
 <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/rasterFromXYZ">rasterFromXYZ</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/as.data.frame">as.data.frame</a></span>(fcs.dir)))</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> fcs.del &lt;-<span class="st"> </span><span class="kw"><a href="../reference/facets.html">facets</a></span>(pObj, <span class="dt">nx =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">ncol</a></span>(rbase) , <span class="dt">ny =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(rbase), <span class="dt">method =</span> <span class="st">"delaunay"</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  number of triangles = 91 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,</span>
<span class="co">#&gt; 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76,</span>
<span class="co">#&gt; 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,  91.</span>
 <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/rasterFromXYZ">rasterFromXYZ</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/as.data.frame">as.data.frame</a></span>(fcs.del)))</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-9-2.png" width="672"></p>
</div>
<div id="idw" class="section level1">
<h1 class="hasAnchor">
<a href="#idw" class="anchor"></a>IDW</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gstat)
idwfun &lt;-<span class="st"> </span><span class="cf">function</span>(xy, value, <span class="dt">grid =</span> <span class="ot">NULL</span>, ...) {
   <span class="cf">if</span> (<span class="kw">is.null</span>(grid)) grid &lt;-<span class="st"> </span><span class="kw"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(xy)
  d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lon =</span> xy[,<span class="dv">1</span>], <span class="dt">lat =</span> xy[,<span class="dv">2</span>], <span class="dt">value =</span> value)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(d) &lt;-<span class="st"> </span><span class="er">~</span>lon<span class="op">+</span>lat
  <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/is.projected">proj4string</a></span>(d) &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/is.projected">proj4string</a></span>(grid)
  ## inverse distance weighted (IDW)
  mg &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/gstat">gstat</a></span>(<span class="dt">id =</span> <span class="st">"value"</span>, <span class="dt">formula =</span> value<span class="op">~</span><span class="dv">1</span>, <span class="dt">locations =</span> <span class="kw">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="dt">data=</span>d, ...) 
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/interpolate">interpolate</a></span>(grid, mg)          
}


dw &lt;-<span class="st"> </span><span class="kw">idwfun</span>(lonlat, val, r0)
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
dw &lt;-<span class="st"> </span><span class="kw">idwfun</span>(lonlat, val, r0, <span class="dt">set=</span><span class="kw">list</span>(<span class="dt">idp =</span> <span class="fl">1.5</span>))
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(dw);<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/contour">contour</a></span>(trigrid, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</div>
<div id="kriging" class="section level1">
<h1 class="hasAnchor">
<a href="#kriging" class="anchor"></a>Kriging</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
krifun &lt;-<span class="st"> </span><span class="cf">function</span>(xy, value, <span class="dt">grid =</span> <span class="ot">NULL</span>, ...) {
   <span class="cf">if</span> (<span class="kw">is.null</span>(grid)) grid &lt;-<span class="st"> </span><span class="kw"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(xy)
  d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lon =</span> xy[,<span class="dv">1</span>], <span class="dt">lat =</span> xy[,<span class="dv">2</span>], <span class="dt">value =</span> value)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(d) &lt;-<span class="st"> </span><span class="er">~</span>lon<span class="op">+</span>lat
  <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/is.projected">proj4string</a></span>(d) &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/is.projected">proj4string</a></span>(grid)
 v &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/variogram">variogram</a></span>(value<span class="op">~</span><span class="dv">1</span>, d)
 m &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/fit.variogram">fit.variogram</a></span>(v, <span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/vgm">vgm</a></span>(<span class="dv">1</span>, <span class="st">"Sph"</span>, <span class="dv">150</span>, <span class="dv">1</span>))
 gOK &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/gstat">gstat</a></span>(<span class="ot">NULL</span>, <span class="st">"value"</span>, value<span class="op">~</span><span class="dv">1</span>, d, <span class="dt">model=</span>m)
 <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/interpolate">interpolate</a></span>(grid, gOK)

}
krigrid &lt;-<span class="st"> </span><span class="kw">krifun</span>(lonlat, val, <span class="dt">grid =</span> r0)
<span class="co">#&gt; [using ordinary kriging]</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(krigrid)</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</div>
<div id="fields" class="section level1">
<h1 class="hasAnchor">
<a href="#fields" class="anchor"></a>fields</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># out &lt;- as.image(d[,varname], x = d[,c(xname, yname)], nx = 25, ny = 25)</span>
<span class="co"># plot(raster(out))</span>
<span class="co"># look&lt;- image.smooth( out, theta= 2.5) </span>
<span class="co"># plot(raster(look))</span>

fsmfun &lt;-<span class="st"> </span><span class="cf">function</span>(xy, value, <span class="dt">grid =</span> <span class="ot">NULL</span>) {
    <span class="cf">if</span> (<span class="kw">is.null</span>(grid)) grid &lt;-<span class="st"> </span><span class="kw"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(xy)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(grid) &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">ncol</a></span>(grid) ## apparently required
  out &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/fields/topics/as.image">as.image</a></span>(value, <span class="dt">x =</span> xy, <span class="dt">nx =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(grid), <span class="dt">ny =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">ncol</a></span>(grid))
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/fields/topics/image.smooth">image.smooth</a></span>( out, <span class="dt">theta=</span> <span class="fl">2.5</span>) )
}

fsmgrid &lt;-<span class="st"> </span><span class="kw">fsmfun</span>(lonlat, val, r0)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(fsmgrid)</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
</div>
<div id="akima" class="section level1">
<h1 class="hasAnchor">
<a href="#akima" class="anchor"></a>Akima</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(akima)
akifun &lt;-<span class="st"> </span><span class="cf">function</span>(xy, value, <span class="dt">grid =</span> <span class="ot">NULL</span>, ...) {
     <span class="cf">if</span> (<span class="kw">is.null</span>(grid)) grid &lt;-<span class="st"> </span><span class="kw"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(xy)
  x0 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/xyFromCell">xFromCol</a></span>(grid)
  y0 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/xyFromCell">yFromRow</a></span>(grid)

  aklin &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/akima/topics/interp">interp</a></span>(xy[,<span class="dv">1</span>], xy[,<span class="dv">2</span>], value, 
              x0, y0, ...)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(<span class="kw">list</span>(<span class="dt">x =</span> aklin<span class="op">$</span>x, <span class="dt">y =</span> <span class="kw">rev</span>(aklin<span class="op">$</span>y), <span class="dt">z =</span> aklin<span class="op">$</span>z[,<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">ncol</a></span>(aklin<span class="op">$</span>z)<span class="op">:</span><span class="dv">1</span>]))
}

akigrid &lt;-<span class="st"> </span><span class="kw">akifun</span>(lonlat, val, <span class="dt">grid =</span> r0)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(akigrid)</code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
<div id="hexagons" class="section level1">
<h1 class="hasAnchor">
<a href="#hexagons" class="anchor"></a>Hexagons?</h1>
<p>(See hexbin, spatstat).</p>
<div id="along-track-distance" class="section level2">
<h2 class="hasAnchor">
<a href="#along-track-distance" class="anchor"></a>Along-track distance</h2>
<p>Previously we used Latitude as our x-axis, this is not very sensible since the track visits the same latitudes at different longitudes. As a simple improvement let’s build an along-track axis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># lonname &lt;- "Longitude [degrees_east]"</span>
<span class="co"># latname &lt;- "Latitude [degrees_north]"</span>
<span class="co"># tname &lt;- "yyyy-mm-ddThh:mm:ss.sss"</span>
<span class="co"># d2 &lt;- szt[asub, c(xname, yname, lonname, latname, varname, tname)]</span>
<span class="co"># d2$date &lt;- as.POSIXct(d2[[tname]])</span>
<span class="co"># d2 &lt;- d2[order(d2$date, d2$Depth), ]</span>
<span class="co"># library(geosphere)</span>
<span class="co"># dists &lt;- numeric(nrow(d2)-1)</span>
<span class="co"># for (i in seq_along(dists)) {</span>
<span class="co">#   dists[i] &lt;- spDistsN1(as.matrix(d2[i, c(lonname, latname)]), as.matrix(d2[i+1, c(lonname, latname), drop = FALSE]), longlat = TRUE)</span>
<span class="co">#   }</span>
<span class="co"># d2$dist &lt;- cumsum(c(0, dists))</span></code></pre></div>
<p>So now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># xname &lt;- "dist"</span>
<span class="co"># d &lt;- d2</span>
<span class="co"># ex &lt;- extent(range(d[, xname]), range(d[, yname])) * 1.2</span>
<span class="co"># rbase &lt;- raster(ex, ncols = 25, nrows = 25)</span>
<span class="co"># rlast &lt;- rasterize(d[,c(xname, yname)], rbase, field = d[,varname])</span>
<span class="co"># </span>
<span class="co"># rmean &lt;- rasterize(d[,c(xname, yname)], rbase, field = d[,varname], fun = mean)</span>
<span class="co"># </span>
<span class="co"># rval &lt;- pretty(d[,varname], n = 15)</span>
<span class="co"># </span>
<span class="co"># plot(rlast, col = colfun(length(rval) - 1), breaks = rval, asp = 1)</span>
<span class="co"># points(d[, c(xname, yname)], cex = 0.2)</span>
<span class="co">#  plot(rmean, col = colfun(length(rval) - 1), breaks = rval, asp = 1)</span>
<span class="co"># points(d[, c(xname, yname)], cex = 0.2)</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># p &lt;- Tps(d[, c(xname, yname)], d[,varname])</span>
<span class="co"># rp &lt;- interpolate(rbase, p)</span>
<span class="co"># rpse &lt;- interpolate(rbase, p, fun = predictSE)</span>
<span class="co">#  plot(rp, col = colfun(length(rval) - 1), breaks = rval, asp = 1)</span>
<span class="co"># points(d[, c(xname, yname)], cex = 0.2)</span>
<span class="co">#  plot(rpse, col = colfun(length(rval) - 1), breaks = rval, asp = 1)</span>
<span class="co"># points(d[, c(xname, yname)], cex = 0.2)</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># ## input must be ppp</span>
<span class="co"># library(spatstat)</span>
<span class="co"># library(maptools)</span>
<span class="co"># rasterToOwin &lt;- function(x) {</span>
<span class="co">#   owin(c(xmin(x), xmax(x)), c(ymin(x), ymax(x)))</span>
<span class="co"># }</span>
<span class="co"># pObj &lt;- ppp(d[,xname], d[,yname], window = rasterToOwin(rbase), marks = d[, varname])</span>
<span class="co"># </span>
<span class="co"># lltes&lt;-delaunay(pObj)</span>
<span class="co"># meanval &lt;- numeric(length(lltes[[3]]))</span>
<span class="co">#   for (i in seq_along(meanval)) {</span>
<span class="co">#   meanval[i] &lt;- mean(marks(pObj[lltes[[3]][[i]]]))</span>
<span class="co">#        }</span>
<span class="co"># plot(as(lltes, "SpatialPolygons"), col = colfun(20)[scl(meanval)*19 + 1])</span>
<span class="co"># points(d[,c(xname, yname)])</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># lltes&lt;-dirichlet(pObj)</span>
<span class="co"># meanval &lt;- numeric(length(lltes[[3]]))</span>
<span class="co">#   for (i in seq_along(meanval)) {</span>
<span class="co">#   meanval[i] &lt;- mean(marks(pObj[lltes[[3]][[i]]]))</span>
<span class="co">#        }</span>
<span class="co"># plot(as(lltes, "SpatialPolygons"), col = colfun(20)[scl(meanval)*19 + 1])</span>
<span class="co"># points(d[,c(xname, yname)])</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># source("maybetin.R")</span>
<span class="co"># </span>
<span class="co"># fcs.dir &lt;- facets(pObj, nx = ncol(rbase) , ny = nrow(rbase), method = "dirichlet")</span>
<span class="co"># plot(rasterFromXYZ(as.data.frame(fcs.dir)))</span>
<span class="co"># fcs.del &lt;- facets(pObj, nx = ncol(rbase) , ny = nrow(rbase), method = "delaunay")</span>
<span class="co"># plot(rasterFromXYZ(as.data.frame(fcs.del)))</span>
<span class="co"># </span>
<span class="co"># library(gstat)</span>
<span class="co"># </span>
<span class="co"># dsp &lt;- d</span>
<span class="co"># coordinates(dsp) &lt;- c(xname, yname)</span>
<span class="co"># ## inverse distance weighted (IDW)</span>
<span class="co"># mg &lt;- gstat(id = "Al", formula = Al~1, locations = c(xname, yname), data=dsp, </span>
<span class="co">#             nmax=7, set=list(idp = .5))</span>
<span class="co"># z &lt;- interpolate(rbase, mg)</span>
<span class="co"># plot(z)</span>
<span class="co"># </span>
<span class="co"># ## with log</span>
<span class="co"># v &lt;- variogram(log(Al)~1, dsp)</span>
<span class="co"># m &lt;- fit.variogram(v, vgm(1, "Sph", 300, 1))</span>
<span class="co"># gOK &lt;- gstat(NULL, "logAl", log(Al)~1, dsp, model=m)</span>
<span class="co"># OK &lt;- interpolate(rbase, gOK)</span>
<span class="co"># plot(OK)</span>
<span class="co"># </span>
<span class="co"># ## without log</span>
<span class="co"># v &lt;- variogram(Al~1, dsp)</span>
<span class="co"># m &lt;- fit.variogram(v, vgm(1, "Sph", 300, 1))</span>
<span class="co"># gOK &lt;- gstat(NULL, "Al", Al~1, dsp, model=m)</span>
<span class="co"># OK &lt;- interpolate(rbase, gOK)</span>
<span class="co"># plot(OK)</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># ## Gaussian</span>
<span class="co"># v &lt;- variogram(Al~1, dsp)</span>
<span class="co"># m &lt;- fit.variogram(v, vgm(1, "Gau", 300, 1))</span>
<span class="co"># gOK &lt;- gstat(NULL, "Al", Al~1, dsp, model=m)</span>
<span class="co"># OK &lt;- interpolate(rbase, gOK)</span>
<span class="co"># plot(OK)</span>
<span class="co"># </span>
<span class="co"># out &lt;- as.image(d[,varname], x = d[,c(xname, yname)], nx = 25, ny = 25)</span>
<span class="co"># plot(raster(out))</span>
<span class="co"># look&lt;- image.smooth( out, theta= 2.5) </span>
<span class="co"># plot(raster(look))</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># library(akima)</span>
<span class="co"># </span>
<span class="co"># x0 &lt;- xFromCol(rbase)</span>
<span class="co"># y0 &lt;- yFromRow(rbase)</span>
<span class="co"># </span>
<span class="co"># aklin &lt;- interp(d[,xname], d[,yname], d[,varname], </span>
<span class="co">#               x0, y0)</span>
<span class="co"># # aksplin &lt;-interp(d[,xname], d[,yname], d[,varname], </span>
<span class="co"># #               x0, y0, linear = FALSE, extrap = TRUE) </span>
<span class="co"># rlin &lt;- raster(list(x = aklin$x, y = rev(aklin$y), z = t(aklin$z[,ncol(aklin$z):1])))</span>
<span class="co"># ##rsplin &lt;- raster(aksplin)</span>
<span class="co"># plot(rlin, col = colfun(length(rval) - 1), breaks = rval, asp = 1)</span>
<span class="co">#points(d[, c(xname, yname)], cex = 0.2)</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup">Setup</a></li>
      <li><a href="#simplistic-rasterization">Simplistic rasterization</a></li>
      <li><a href="#thin-plate-spline-interpolation-">Thin plate spline interpolation.</a></li>
      <li><a href="#bilinear-triangulation-">Bilinear triangulation.</a></li>
      <li><a href="#delaunay-and-diriclet">Delaunay and Diriclet</a></li>
      <li><a href="#idw">IDW</a></li>
      <li><a href="#kriging">Kriging</a></li>
      <li><a href="#fields">fields</a></li>
      <li><a href="#akima">Akima</a></li>
      <li>
<a href="#hexagons">Hexagons?</a><ul class="nav nav-pills nav-stacked">
<li><a href="#along-track-distance">Along-track distance</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michael Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
